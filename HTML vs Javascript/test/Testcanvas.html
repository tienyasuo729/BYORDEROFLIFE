<!DOCTYPE html>
<html>
<head>
    <title>Hình tròn và tọa độ</title>
    <style>
        #canvas {
            border: 1px solid #d3d3d3;
            cursor: crosshair;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="400" height="400"></canvas>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        var circles = [];
        var isDrawing = false;
        var startCircle = null;
        var connectedCircles = [];

        // Tạo hình tròn
        function createCircle(x, y, radius) {
            var circle = {
                x: x,
                y: y,
                radius: radius,
                isConnected: false
            };
            circles.push(circle);
            return circle;
        }

        // Vẽ hình tròn
        function drawCircle(circle) {
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI);
            ctx.fillStyle = 'black';
            ctx.fill();
            ctx.closePath();
        }

        // Vẽ các đường nối
        function drawConnections() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            circles.forEach(function(circle) {
                drawCircle(circle);
            });
            connectedCircles.forEach(function(connection) {
                ctx.beginPath();
                ctx.moveTo(connection.startCircle.x, connection.startCircle.y);
                ctx.lineTo(connection.endCircle.x, connection.endCircle.y);
                ctx.strokeStyle = 'black';
                ctx.stroke();
            });
        }

        // Xử lý sự kiện mousedown trên khung canvas
        $('#canvas').mousedown(function(event) {
            var rect = canvas.getBoundingClientRect();
            var mouseX = event.clientX - rect.left;
            var mouseY = event.clientY - rect.top;

            // Kiểm tra xem con chuột có nằm trên hình tròn không
            var hoveredCircle = circles.find(function(circle) {
                var distance = Math.sqrt(Math.pow(mouseX - circle.x, 2) + Math.pow(mouseY - circle.y, 2));
                return distance <= circle.radius;
            });

            if (hoveredCircle) {
                isDrawing = true;
                startCircle = hoveredCircle;
            }
        });

        // Xử lý sự kiện mousemove trên khung canvas
        $('#canvas').mousemove(function(event) {
            if (isDrawing) {
                var rect = canvas.getBoundingClientRect();
                var mouseX = event.clientX - rect.left;
                var mouseY = event.clientY - rect.top;

                // Xoá các đường nối đã vẽ trước đó
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Vẽ lại các hình tròn
                circles.forEach(function(circle) {
                    drawCircle(circle);
                });

                // Vẽ đường nối từ hình tròn ban đầu tới vị trí hiện tại của chuột
                ctx.beginPath();
                ctx.moveTo(startCircle.x, startCircle.y);
                ctx.lineTo(mouseX, mouseY);
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        });

        // Xử lý sự kiện mouseup trên khung canvas
        $('#canvas').mouseup(function(event) {
            if (isDrawing) {
                isDrawing = false;
                var rect = canvas.getBoundingClientRect();
                var mouseX = event.clientX - rect.left;
                var mouseY = event.clientY - rect.top;

                // Kiểm tra xem con chuột có nằm trên hình tròn không
                var endCircle = circles.find(function(circle) {
                    var distance = Math.sqrt(Math.pow(mouseX - circle.x, 2) + Math.pow(mouseY - circle.y, 2));
                    return distance <= circle.radius;
                });

                if (endCircle && startCircle !== endCircle && !endCircle.isConnected) {
                    // Kết nối hai hình tròn lại với nhau
                    startCircle.isConnected = true;
                    endCircle.isConnected = true;

                    // Thêm đường nối vào danh sách
                    connectedCircles.push({
                        startCircle: startCircle,
                        endCircle: endCircle
                    });
                }

                // Vẽ lại các đường nối và hình tròn
                drawConnections();
            }
        });

        // Khởi tạo các hình tròn và vẽ lên canvas
        createCircle(100, 100, 50);
        createCircle(200, 100, 50);
        createCircle(300, 100, 50);
        createCircle(100, 200, 50);
        createCircle(200, 200, 50);
        createCircle(300, 200, 50);
        createCircle(100, 300, 50);
        createCircle(200, 300, 50);
        createCircle(300, 300, 50);

        // Vẽ các đường nối và hình tròn ban đầu
        drawConnections();
    });
</script>
</body>
</html>
